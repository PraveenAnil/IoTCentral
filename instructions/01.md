# Exercise 1: Getting Started with Azure IoT Central

## Overview

This exercise will cover how to get started with the IoT Central Connected logistics application template.

You will be performing the following activities:

## Instructions

### Getting Started with Lab

1. Once the environment is provisioned, a virtual machine (JumpVM) on the left and lab guide on the right will get loaded in your browser. Use this virtual machine throughout the workshop to perform the lab.

1. To get the lab environment details, you can select the **Lab Environment** tab, you can locate the **Lab Environment** tab on the upper right corner. Additionally, the credentials will also be emailed to your email address provided during registration.

   ![](media/lab_details.png "Lab Environment")

 > You will see Suffix/DeploymentID value on the **Lab Environment** tab, please use it wherever you see SUFFIX or DeploymentID in lab steps. This is a unique number associated with each lab deployment. 
 
#### Task 1: Log in to Azure Portal and verify the pre-deployed resources

1. 

### Task 2: Create a connected logistics application 

1. In the virtual machine provided on the left side, open a new browser window and navigate to the **Azure IoT Central** (<https://apps.azureiotcentral.com/>).

1. From the top right corner click on user icon, when prompted use the azure credentials provided in the **Environment Details** tab to log in to the Azure IoT Central portal.

1. Select **Build** from the left-hand navigation bar and then select the **Retail** tab. Notice that there are several options that provide a more advanced starting point for certain scenarios.

1. In **Retail** tab select **Create app** under **Connected Logistics Application**.

1. **Create app** opens the **New application form**. Enter the following details:

     - **Application name**: Enter your friendly application name or you can use default suggested name.
     
     - **URL**: you can use suggested default URL or enter your friendly unique memorable URL.
     
     - **Pricing plan**: Select **Standard 2**.

     - **Billing info**: Select directory, Azure subscription, and region to provision the resources.
     
1. Select **create** at the bottom of the page to deploy your application. 

1. Wait a few seconds while the app resource is built, then you should see a Dashboard with a few default links.

### Task 3: Explore the default key features in the application 

1. In the new created application page from the left hand menu select **Dashboard**.

1. This dashboard is pre-configured to show the critical logistics device operations activity.

1. The dashboard enables two different gateway device management operations:

     - View the logistics routes for truck shipments and the location details of ocean shipments.

     - View the gateway status and other relevant information.
     
1. The dashboard consists of different kinds of tiles:
 
    - **Location**: This tile displays the location of your devices based on time range.
    
    - **Gateway state**:
    
    - **Logistcs location**:
    
    - **Mutlimodal transport**:
    
    - **Battery utilization**:
    
    - **Tag trends**: 

1. From the dashboard you can track the total number of gateways, active, and unknown tags.

1. You can also do device management operations such as: update firmware, disable and enable sensors, update a sensor threshold, update telemetry intervals, and update device service contracts.

1. To customize the dashboard from the top navigation bar click on **Edit**. After the dashboard is in edit mode, you can add new tiles or you can configure it.

1. In the edit dashboard page in the left navigation bar under **Dashboard settings** you can change the **Dashboard name**, select the type of visibility you want.

1. To add a new tile to your dashboard uhder **Add a tile** option:
    
      - **Device Group**: From the drop dwon select **Logistics Gateway** device group
      
      - **Devices**: Select all the devices.
      
      - **Telemetry**: Select any of the  telemetry you want to view.
      
      Once done click on **Add tile** button.

1. You can find your newly added tile on the dashboard.

1. In the edit dashboard page select **Location** tile and click on **Configure** button from the top right of your location tile. From here you can update the tile configuration.

1. Once you have made changes to **Dashboard** click on **Save**.

1. From the left navigation menu  select **Device templates** under **App settings**. Templates contain device capabilities. They also determine how you view data from your devices.

1. In the **Device templates** page, click on **Logistics Gateway** to see the gateway capability model. A capability model is structured around the Gateway Telemetry & Property and Gateway Commands interfaces.

1. In the **Logistics Gateway** page click on **Gateway Telemetry & Property**. This interface defines all the telemetry related to sensors, location, and device information. The interface also defines device twin property capabilities such as sensor thresholds and update intervals.

1. Now click on **Gateway Commands** this interface organizes all the gateway command capabilities.

1. Switch back to the **Device Templates** page, from here you can add new device templates by clicking on **+ New** icon.

1. From the left navigation menu select **Rules** to see the rules in this application template. These rules are configured to email notifications to the operators for further investigations:

    - **Gateway theft alert**: This rule triggers when there's unexpected light detection by the sensors during the journey. Operators must be notified immediately to investigate potential theft.

    - **Lost Gateway alert**: This rule triggers if the gateway doesn't report to the cloud for a prolonged period. The gateway could be unresponsive because of low battery, loss of connectivity, or device damage.
    
1. Click on **Gateway theft alert**, to enable the rule, toggle the **Enabled/Disabled** button in the rule header.

1. By default, the rule automatically applies to all the devices associated with the device template. To filter for a subset of the devices, select **+ Filter** and use device properties to identify the devices.

1. Under conditions section select **light** in the Telemetry dropdown. Next, choose **Is greater than** as the Operator and enter **1000** as the Value.

1. Optionally, you can set a **Time aggregation**. When you select a time aggregation, you must also select an aggregation type, such as average or sum from the aggregation drop-down.

1. After the condition is defined, you set up the actions to take when the rule fires. Actions are invoked when all the conditions specified in the rule evaluate to true.

1. Select **+ Email** in the Actions section.

1. Enter the display name for the action, your email address in the **To field**, and you can also provide a note if needed.

1. To save the action, choose **Done** and click on **Save**. The rule goes live within a few minutes and starts monitoring telemetry being sent to your application. When the condition specified in the rule is met, the rule triggers the configured email action.

1. Now from the left navigation menu select **Jobs**. Jobs let you do bulk updates to device and cloud properties and run commands.
     
     

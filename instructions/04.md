# Exercise 4: IoT Central Openness and Integrations

## Overview

In this exercise, you will see the openness and the integration capabilities of IoT Central

### Task 1: Control devices programmatically using IoT Central Rest API

#### Fetch API Tokens

1. In the application page from the left navigation menu, under App settings click on **Administration**.

1. In the **Administration** page select **API tokens**. In the API tokens page click on **+ Generate tokens**.

   ![](media/img60.png) 

1. Enter **admin** as the Token name and under **Role** select **Administrator**. Then select **Generate**.

   ![](media/img61.png) 

1. Copy the generated **API token** and save it locally in a text file. If you lose the token, you'll have to regenerate it.

1. In the **Administrator** page click on **Your application** and copy the **Application name** value and save it locally in a text file.

   ![](media/img62.png) 

1. In the **Application** web page from the lef hand menu navigate to **Devices** and in **All devices** tab copy the **Device ID** of **SN 100** device. Save the value locally in the text file.

   ![](media/img63.png) 

1. Now open a new tab and sign in to **Azure portal** at  https://portal.azure.com/. When prompted enter the credentials provided in the environment details page.

1. From the **Azure portal**, open the **Azure Cloud Shell** by clicking on the icon in the top right of the Azure Portal.

   ![](media/img64.png) 

     > **Note** : If this is the first time you are starting Cloud Shell and you are presented with the You have no storage mounted message, select the subscription you are using in this lab, and click on show advanced settings under storage account enter a unique name, under file share enter fileshare. Click on create storage.

1. When prompted to select either **Bash** or **PowerShell**, select **Bash**.

1. In the **Bash** session, within the Cloud Shell pane, replace the **ADD YOUR TOKEN HERE** in the following command with the **API Token** value which you copied earlier and run it. This command saves the API token in an environment variable to use later in the module.

    ```BASH
       API_TOKEN="ADD YOUR TOKEN HERE"
    ```
    ![](media/img65.png) 
    
1. Replace the **YOUR APPLLICATION NAME** in the following command with your application name value which you copied earlier and run it in the Cloud Shell. This command saves the Application URL in an environment variable to use later in the module.

   
    ```BASH
        APP_NAME="ADD YOUR APPLICATION NAME HERE"
    ```
    
    ![](media/img66.png) 
        
 1. To get list of all available devices in your application run the following command.
   
     ```BASH
        az rest -m get -u https://$APP_NAME.azureiotcentral.com/api/preview/devices --headers Authorization="$API_TOKEN"
    ```
    
    ![](media/img67.png) 
    
 1. Replace the **device-id** in the following command with your **device-id** value which you copied earlier and run it in the Cloud Shell. This command provides the details about list of components associated with the device template.
 
     ```BASH
        az rest -m get -u https://$APP_NAME.azureiotcentral.com/api/preview/devices/device-id/components  --headers Authorization="$API_TOKEN"
    ```

    ![](media/img68.png) 
    
1. Run the following command to get disable sensor on the device. Make sure to replace **device-id**.

   ```BASH
     az rest -m post  -u https://$APP_NAME.azureiotcentral.com/api/preview/devices/device-id/components/Logistics_Gateway_2k7/commands/DisableSensor  --headers Authorization="$API_TOKEN" --body '{"Disable Sensor": "DisableSensor"}'
   ```
   
   ![](media/img69.png)
   
1. To verify output switch back to the browser tab where your application page is open. In the application page from the left hand menu select **Device** and click on **SN 100** device.

   ![](media/img72.png) 

1. In the device page click on **Raw data** tab and under **Timestamp** verify the status of device is **OFFLINE**.

   ![](media/img73.png) 



